{
    "title": "Instagram Comment Lead Intelligence",
    "type": "object",
    "schemaVersion": 1,
    "properties": {
        "targetUrls": {
            "title": "Target URLs (Posts or Profiles)",
            "type": "array",
            "description": "List of Instagram Post or Profile URLs. Profiles will be expanded to their latest posts.",
            "editor": "requestListSources",
            "prefill": [
                {
                    "url": "https://www.instagram.com/p/Cush2lzNPk/"
                }
            ]
        },
        "sessionId": {
            "title": "Session ID (Required)",
            "type": "string",
            "description": "Instagram 'sessionid' cookie value only (not the full cookie string).",
            "editor": "textfield",
            "isSecret": true
        },
        "sessionCookie": {
            "title": "Session Cookie (Optional)",
            "type": "string",
            "description": "Full browser cookie string copied from DevTools (must include sessionid=...). The actor will extract sessionid automatically.",
            "editor": "textfield",
            "isSecret": true
        },
        "maxComments": {
            "title": "Max Comments Per Post",
            "type": "integer",
            "description": "Limit the depth of scraping to save costs.",
            "default": 1000,
            "minimum": 1
        },
        "maxPages": {
            "title": "Max Comment Pages (Optional)",
            "type": "integer",
            "description": "Maximum number of comment pages to paginate through. Leave empty for all pages.",
            "minimum": 1
        },
        "samplingMode": {
            "title": "Sampling Mode",
            "type": "string",
            "description": "Choose how to sample comments.",
            "editor": "select",
            "default": "ALL",
            "enum": [
                "ALL",
                "RANDOM",
                "TOP_LIKED"
            ]
        },
        "samplingProbability": {
            "title": "Sampling Probability",
            "type": "number",
            "description": "For RANDOM mode: probability to skip a page (0-1).",
            "default": 0.3,
            "minimum": 0,
            "maximum": 1
        },
        "minLikes": {
            "title": "Minimum Likes (TOP_LIKED)",
            "type": "integer",
            "description": "For TOP_LIKED mode: minimum likes required for a comment to be processed.",
            "default": 5,
            "minimum": 0
        },
        "targetLeadCount": {
            "title": "Target High-Intent Lead Count",
            "type": "integer",
            "description": "Stop scraping when HIGH intent leads reach this number.",
            "default": 50,
            "minimum": 1
        },
        "userDefinedLimitMB": {
            "title": "Max Dataset Size (MB)",
            "type": "number",
            "description": "Abort if estimated dataset size exceeds this limit.",
            "minimum": 1
        },
        "scrapeSince": {
            "title": "Delta Mode (Scrape Comments Since)",
            "type": "string",
            "description": "Only scrape comments posted AFTER this date. Format: YYYY-MM-DD or ISO. Leave empty for all.",
            "editor": "textfield",
            "pattern": "^\\d{4}-\\d{2}-\\d{2}(.*)?$"
        },
        "enrichLeads": {
            "title": "Enrich High-Intent Leads",
            "type": "boolean",
            "description": "If enabled, the actor will visit lead profiles to obtain follower buckets and tiers.",
            "default": false
        },
        "intentWeights": {
            "title": "Intent Weights Override (Optional)",
            "type": "object",
            "description": "JSON dictionary to override intent keyword weights. Example: {\"BUY_INTENT\": {\"buy\": 0.9, \"order\": 0.7}}",
            "editor": "json"
        },
        "languageDetection": {
            "title": "Language Detection (Optional)",
            "type": "object",
            "description": "Lightweight language detection settings. Enable FastText only if FASTTEXT_BIN and FASTTEXT_MODEL are available.",
            "editor": "json",
            "default": {
                "enableFastText": false,
                "fastTextMinChars": 20,
                "fastTextTimeoutMs": 2000
            },
            "properties": {
                "enableFastText": {
                    "title": "Enable FastText",
                    "type": "boolean",
                    "description": "Use fastText CLI as a fallback (requires FASTTEXT_BIN and FASTTEXT_MODEL).",
                    "default": false
                },
                "fastTextMinChars": {
                    "title": "FastText Min Chars",
                    "type": "integer",
                    "description": "Minimum characters required to call FastText.",
                    "minimum": 0
                },
                "fastTextTimeoutMs": {
                    "title": "FastText Timeout (ms)",
                    "type": "integer",
                    "description": "Timeout for the FastText process in milliseconds.",
                    "minimum": 0
                }
            }
        },
        "maxPostsPerProfile": {
            "title": "Max Posts Per Profile",
            "type": "integer",
            "description": "If a profile URL is provided, scrape this many recent posts.",
            "default": 3
        },
        "minLeadScore": {
            "title": "Minimum Lead Score",
            "type": "string",
            "description": "Filter output to only include leads at or above this category (LOW, MEDIUM, HIGH).",
            "editor": "select",
            "default": "LOW",
            "enum": [
                "LOW",
                "MEDIUM",
                "HIGH"
            ]
        },
        "webhookUrl": {
            "title": "Webhook URL",
            "type": "string",
            "description": "Optional webhook URL to receive high-intent leads (leadScore HIGH and intent_score > 0.7).",
            "editor": "textfield"
        },
        "webhookConfig": {
            "title": "Webhook Retry Settings (Optional)",
            "type": "object",
            "description": "Advanced retry/backoff settings for webhook delivery. Leave empty to use defaults.",
            "editor": "json",
            "default": {
                "maxRetries": 4,
                "baseDelayMs": 500,
                "maxDelayMs": 8000,
                "timeoutMs": 8000,
                "concurrency": 3
            },
            "properties": {
                "maxRetries": {
                    "title": "Max Retries",
                    "type": "integer",
                    "description": "Number of retry attempts for failed webhook calls.",
                    "minimum": 0
                },
                "baseDelayMs": {
                    "title": "Base Delay (ms)",
                    "type": "integer",
                    "description": "Base delay used for exponential backoff in milliseconds.",
                    "minimum": 0
                },
                "maxDelayMs": {
                    "title": "Max Delay (ms)",
                    "type": "integer",
                    "description": "Maximum backoff delay in milliseconds.",
                    "minimum": 0
                },
                "timeoutMs": {
                    "title": "Request Timeout (ms)",
                    "type": "integer",
                    "description": "Timeout for webhook HTTP requests in milliseconds.",
                    "minimum": 0
                },
                "concurrency": {
                    "title": "Webhook Concurrency",
                    "type": "integer",
                    "description": "Maximum number of concurrent webhook deliveries.",
                    "minimum": 1
                }
            }
        },
        "proxyConfiguration": {
            "title": "Proxy Configuration",
            "type": "object",
            "description": "Apify proxy settings. Leave default to use Apify Proxy.",
            "editor": "proxy",
            "default": {
                "useApifyProxy": true
            }
        }
    },
    "required": [
        "targetUrls",
        "sessionId"
    ]
}
